<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Voice Brain - Notatki z Przypomnieniami</title>
    
    <meta name="theme-color" content="#0f172a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="description" content="Tw√≥j osobisty dziennik g≈Çosowy z inteligentnymi przypomnieniami.">

    <link rel="manifest" href="data:application/manifest+json;base64,eyJuYW1lIjoiVm9pY2VCcmFpbiIsInNob3J0X25hbWUiOiJWb2ljZUJyYWluIiwic3RhcnRfdXJsIjoiLiIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiMwZjE3MmEiLCJ0aGVtZV9jb2xvciI6IiMwZjE3MmEiLCJpY29ucyI6W3sic3JjIjoiaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9AZm9ydGF3ZXNvbWUvZm9udGF3ZXNvbWUtZnJlZUA2L3N2Z3Mvc29saWQvbWljcm9waG9uZS5zdmciLCJzaXplcyI6IjUxMng1MTIiLCJ0eXBlIjoiaW1hZ2Uvc3ZnK3htbCJ9XX0=" />

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        slate: {
                            800: '#1e293b',
                            900: '#0f172a',
                            750: '#252f40',
                        },
                        indigo: {
                            500: '#6366f1',
                        }
                    },
                    animation: {
                        'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/dexie@3.2.4/dist/dexie.js"></script>
    
    <style>
        [x-cloak] { display: none !important; }
        ::-webkit-scrollbar { width: 0px; background: transparent; }
        body { -webkit-tap-highlight-color: transparent; }
        textarea { field-sizing: content; min-height: 3rem; }
        .recording-wave {
            display: inline-block;
            width: 6px;
            height: 20px;
            margin: 0 2px;
            background-color: #6366f1;
            border-radius: 3px;
            animation: wave 1s infinite ease-in-out;
        }
        .recording-wave:nth-child(2) { animation-delay: 0.1s; }
        .recording-wave:nth-child(3) { animation-delay: 0.2s; }
        @keyframes wave {
            0%, 100% { height: 10px; opacity: 0.5; }
            50% { height: 25px; opacity: 1; }
        }
        .reminder-badge {
            animation: pulse-glow 2s ease-in-out infinite;
        }
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 5px rgba(251, 191, 36, 0.5); }
            50% { box-shadow: 0 0 20px rgba(251, 191, 36, 0.8); }
        }
    </style>

    <script>
        // Deklaracja zmiennych globalnych
        let audioCtx;
        const db = new Dexie('VoiceBrainDB');
        db.version(3).stores({ 
            notes: '++id, date, text, title, hasReminder, reminderDate, reminderCompleted' 
        });

        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
        }

        function playReminderSound() {
            initAudio();
            const playTone = (freq, startTime, duration, volume = 0.3) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(freq, startTime);
                gain.gain.setValueAtTime(0, startTime);
                gain.gain.linearRampToValueAtTime(volume, startTime + 0.05);
                gain.gain.exponentialRampToValueAtTime(0.001, startTime + duration);
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.start(startTime);
                osc.stop(startTime + duration);
            };
            const now = audioCtx.currentTime;
            playTone(880, now + 0.0, 0.4);
            playTone(659, now + 0.2, 0.4);
            playTone(880, now + 0.6, 0.4);
            playTone(659, now + 0.8, 0.4);
            playTone(1046, now + 1.2, 0.8, 0.2);
            if (navigator.vibrate) navigator.vibrate([400, 200, 400, 200, 400]);
        }

        function playBeep(type) {
            initAudio();
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            if (type === 'start') {
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(440, audioCtx.currentTime); 
                oscillator.frequency.exponentialRampToValueAtTime(880, audioCtx.currentTime + 0.1); 
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.1);
            } else {
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(880, audioCtx.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(440, audioCtx.currentTime + 0.1); 
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.1);
            }
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.1);
        }

        // Rejestracja logiki Alpine.js przed za≈Çadowaniem biblioteki
        document.addEventListener('alpine:init', () => {
            Alpine.data('voiceJournal', () => ({
                notes: [],
                searchQuery: '',
                isRecording: false,
                manualStop: false, 
                currentTranscript: '',
                sessionTranscriptBuffer: '',
                currentSessionFinal: '',
                isLoading: true,
                errorMsg: null,
                detectedReminder: false,
                showReminders: false,
                editingNoteId: null,
                editingText: '',
                inAppNotification: null,
                inAppNotificationTimeout: null,

                async init() {
                    try {
                        await db.open();
                    } catch (e) {
                        this.errorMsg = `B≈ÇƒÖd DB: ${e.message}`;
                    }
                    await this.loadNotes();
                    this.setupSpeechRecognition();
                    this.startReminderCheck();
                },

                async loadNotes() {
                    try {
                        const data = await db.notes.toArray();
                        this.notes = data.sort((a, b) => b.date - a.date);
                    } catch (e) {
                        this.errorMsg = 'Nie uda≈Ço siƒô za≈Çadowaƒá notatek.';
                    } finally {
                        this.isLoading = false;
                    }
                },

                get filteredNotes() {
                    if (!this.searchQuery) return this.notes;
                    const q = this.searchQuery.toLowerCase();
                    return this.notes.filter(n => (n.title?.toLowerCase().includes(q)) || (n.text?.toLowerCase().includes(q)));
                },

                get groupedNotes() {
                    const groups = {};
                    const today = new Date().toDateString();
                    const yesterday = new Date(new Date().setDate(new Date().getDate() - 1)).toDateString();
                    this.filteredNotes.forEach(note => {
                        const d = new Date(note.date).toDateString();
                        let title = d;
                        if (d === today) title = 'Dzisiaj';
                        else if (d === yesterday) title = 'Wczoraj';
                        else title = new Date(note.date).toLocaleDateString('pl-PL', { weekday: 'long', day: 'numeric', month: 'long' });
                        if (!groups[title]) groups[title] = { title, notes: [] };
                        groups[title].notes.push(note);
                    });
                    return Object.values(groups); 
                },

                get upcomingReminders() {
                    const now = new Date();
                    return this.notes
                        .filter(n => n.hasReminder && !n.reminderCompleted && new Date(n.reminderDate) > now)
                        .sort((a, b) => new Date(a.reminderDate) - new Date(b.reminderDate))
                        .slice(0, 10);
                },

                get activeRemindersCount() {
                    return this.upcomingReminders.length;
                },

                parseReminderFromText(text) {
                    const lowerText = text.toLowerCase();
                    const patterns = [
                        { regex: /przypomnij\s+mi\s+(jutro|dzisiaj|dzi≈õ)\s+(o\s+)?(\d{1,2})(:\d{2})?/i, type: 'specific' },
                        { regex: /przypomnij\s+(jutro|dzisiaj|dzi≈õ)\s+(o\s+)?(\d{1,2})(:\d{2})?/i, type: 'specific' },
                        { regex: /za\s+(\d+)\s+(godzin|godzinƒô|godziny|minut|minutƒô|minuty|dni|dzie≈Ñ)/i, type: 'relative' },
                        { regex: /(jutro|dzisiaj|dzi≈õ)\s+rano/i, type: 'morning' },
                        { regex: /(jutro|dzisiaj|dzi≈õ)\s+wieczorem/i, type: 'evening' },
                    ];
                    for (const pattern of patterns) {
                        const m = lowerText.match(pattern.regex);
                        if (m) {
                            const d = this.calculateReminderDate(m, pattern.type);
                            if (d) return { hasReminder: true, reminderDate: d, cleanedText: text.replace(m[0], '').trim() || text };
                        }
                    }
                    return { hasReminder: false, cleanedText: text };
                },

                calculateReminderDate(match, type) {
                    const now = new Date();
                    let d = new Date();
                    if (type === 'specific') {
                        if (match[1] === 'jutro') d.setDate(d.getDate() + 1);
                        d.setHours(parseInt(match[3]), match[4] ? parseInt(match[4].substring(1)) : 0, 0, 0);
                    } else if (type === 'relative') {
                        const val = parseInt(match[1]);
                        const unit = match[2];
                        if (unit.includes('godzin')) d.setHours(d.getHours() + val);
                        else if (unit.includes('minut')) d.setMinutes(d.getMinutes() + val);
                        else if (unit.includes('dni') || unit.includes('dzie≈Ñ')) d.setDate(d.getDate() + val);
                    } else if (type === 'morning') {
                        if (match[1] === 'jutro') d.setDate(d.getDate() + 1);
                        d.setHours(9, 0, 0, 0);
                    } else if (type === 'evening') {
                        if (match[1] === 'jutro') d.setDate(d.getDate() + 1);
                        d.setHours(18, 0, 0, 0);
                    }
                    return d > now ? d : null;
                },

                generateAutoTitle(text) {
                    if (!text) return 'Nowa notatka';
                    const words = text.trim().split(/\s+/).slice(0, 4);
                    let t = words.join(' ');
                    t = t.charAt(0).toUpperCase() + t.slice(1);
                    return words.length >= 4 ? t + '...' : t;
                },

                async saveNote(text) {
                    if (!text?.trim()) return;
                    const reminder = this.parseReminderFromText(text);
                    const noteData = {
                        text: reminder.cleanedText.trim(),
                        title: this.generateAutoTitle(reminder.cleanedText),
                        date: new Date(),
                        hasReminder: reminder.hasReminder,
                        reminderDate: reminder.reminderDate,
                        reminderCompleted: false
                    };
                    await db.notes.add(noteData);
                    await this.loadNotes();
                    if (reminder.hasReminder) {
                        this.showInAppNotification("Zapisano", `Przypomnienie na ${this.formatReminderTime(reminder.reminderDate)}`);
                    }
                },

                async deleteNote(id) {
                    if (confirm('UsunƒÖƒá?')) { await db.notes.delete(id); await this.loadNotes(); }
                },

                async deleteReminder(id) {
                    await db.notes.update(id, { hasReminder: false, reminderCompleted: true });
                    await this.loadNotes();
                },

                startEditing(note) { this.editingNoteId = note.id; this.editingText = note.text; },
                cancelEditing() { this.editingNoteId = null; },
                async saveEdit(id) {
                    await db.notes.update(id, { text: this.editingText, title: this.generateAutoTitle(this.editingText) });
                    await this.loadNotes();
                    this.editingNoteId = null;
                },

                showInAppNotification(title, body) {
                    this.inAppNotification = { title, body };
                    if (this.inAppNotificationTimeout) clearTimeout(this.inAppNotificationTimeout);
                    this.inAppNotificationTimeout = setTimeout(() => this.inAppNotification = null, 5000);
                },

                startReminderCheck() {
                    this.checkReminders();
                    setInterval(() => this.checkReminders(), 10000);
                },

                async checkReminders() {
                    const now = new Date();
                    const due = this.notes.filter(n => n.hasReminder && !n.reminderCompleted && new Date(n.reminderDate) <= now);
                    for (const r of due) {
                        playReminderSound();
                        this.showInAppNotification("‚è∞ Przypomnienie!", r.title);
                        await db.notes.update(r.id, { reminderCompleted: true });
                    }
                    if (due.length > 0) await this.loadNotes();
                },

                async requestNotificationPermission() {
                    if ("Notification" in window) {
                        const p = await Notification.requestPermission();
                        this.showInAppNotification("Powiadomienia", p === "granted" ? "W≈ÇƒÖczone" : "Zablokowane");
                    }
                },

                async exportBackup() {
                    const data = await db.notes.toArray();
                    const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
                    const a = document.createElement('a');
                    a.href = URL.createObjectURL(blob);
                    a.download = `voice-brain-backup-${new Date().toISOString().slice(0,10)}.json`;
                    a.click();
                },

                setupSpeechRecognition() {
                    const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
                    if (!SR) this.errorMsg = 'Brak wsparcia mowy.';
                    else this.SRClass = SR;
                },

                startRecordingLoop() {
                    if (!this.SRClass) return;
                    this.recognition = new this.SRClass();
                    this.recognition.continuous = true;
                    this.recognition.interimResults = true;
                    this.recognition.lang = 'pl-PL';
                    this.recognition.onstart = () => { this.isRecording = true; playBeep('start'); };
                    this.recognition.onresult = (e) => {
                        const last = e.results[e.results.length - 1];
                        this.currentTranscript = last[0].transcript;
                        if (last.isFinal) {
                            this.currentSessionFinal = last[0].transcript;
                            if (this.parseReminderFromText(last[0].transcript).hasReminder) this.detectedReminder = true;
                        }
                    };
                    this.recognition.onend = () => {
                        if (this.currentSessionFinal.trim()) this.sessionTranscriptBuffer += (this.sessionTranscriptBuffer ? ' ' : '') + this.currentSessionFinal.trim();
                        if (!this.manualStop && this.isRecording) setTimeout(() => this.startRecordingLoop(), 100);
                        else {
                            this.isRecording = false;
                            playBeep('stop');
                            if (this.sessionTranscriptBuffer) this.saveNote(this.sessionTranscriptBuffer);
                            this.sessionTranscriptBuffer = '';
                        }
                    };
                    this.recognition.start();
                },

                toggleRecording() {
                    initAudio();
                    if (this.isRecording) { this.manualStop = true; this.recognition?.stop(); }
                    else { this.manualStop = false; this.sessionTranscriptBuffer = ''; this.currentTranscript = ''; this.detectedReminder = false; this.startRecordingLoop(); }
                },

                formatTime(d) { return new Date(d).toLocaleTimeString('pl-PL', { hour: '2-digit', minute: '2-digit' }); },
                formatReminderTime(d) {
                    const date = new Date(d);
                    const isToday = date.toDateString() === new Date().toDateString();
                    const day = isToday ? 'Dzisiaj' : date.toLocaleDateString('pl-PL', { day: 'numeric', month: 'short' });
                    return `${day} o ${date.toLocaleTimeString('pl-PL', { hour: '2-digit', minute: '2-digit' })}`;
                },
                formatReminderBadge(d) {
                    const diff = Math.floor((new Date(d) - new Date()) / 60000);
                    return diff < 60 ? `${diff}m` : `${Math.floor(diff/60)}h`;
                }
            }));
        });
    </script>
    
    <!-- Alpine.js ≈Çadowany na ko≈Ñcu nag≈Ç√≥wka z atrybutem defer -->
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>
</head>
<body class="bg-slate-900 text-white font-sans antialiased min-h-screen flex flex-col relative" x-data="voiceJournal()" x-cloak>

    <header class="sticky top-0 z-50 bg-slate-900/95 backdrop-blur-sm p-4 border-b border-slate-800 shadow-md">
        <div class="max-w-md mx-auto">
            <div class="flex justify-between items-center mb-3">
                <h1 class="text-xl font-bold tracking-wide text-indigo-400 flex items-center">
                    <i class="fas fa-microphone-alt mr-2"></i>Voice Brain
                    <span class="ml-2 text-xs bg-amber-500/20 text-amber-300 px-2 py-0.5 rounded-full">+Przypomnienia</span>
                </h1>
                
                <div class="flex items-center space-x-2">
                    <button @click="showReminders = !showReminders" class="relative text-slate-400 hover:text-amber-400 transition-colors p-2">
                        <i class="fas fa-bell"></i>
                        <span x-show="activeRemindersCount > 0" class="absolute -top-1 -right-1 bg-amber-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center" x-text="activeRemindersCount"></span>
                    </button>
                    
                    <div class="relative" x-data="{ open: false }">
                        <button @click="open = !open" class="text-slate-400 hover:text-white transition-colors p-2">
                            <i class="fas fa-cog"></i>
                        </button>
                        <div x-show="open" 
                             @click.outside="open = false"
                             x-transition.origin.top.right
                             class="absolute right-0 top-full mt-2 w-52 bg-slate-800 rounded-lg shadow-xl border border-slate-700 z-50 overflow-hidden">
                            <button @click="playReminderSound(); open = false" class="w-full text-left px-4 py-3 text-sm text-amber-300 hover:bg-slate-700 transition-colors flex items-center">
                                <i class="fas fa-volume-up mr-2 w-5"></i> Przetestuj d≈∫wiƒôk
                            </button>
                            <button @click="requestNotificationPermission(); open = false" class="w-full text-left px-4 py-3 text-sm text-slate-300 hover:bg-slate-700 hover:text-white transition-colors flex items-center">
                                <i class="fas fa-bell mr-2 w-5"></i> Powiadomienia
                            </button>
                            <button @click="exportBackup(); open = false" class="w-full text-left px-4 py-3 text-sm text-slate-300 hover:bg-slate-700 hover:text-white transition-colors flex items-center">
                                <i class="fas fa-file-export mr-2 w-5"></i> Eksportuj kopiƒô
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="relative">
                <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400"></i>
                <input 
                    type="text" 
                    x-model="searchQuery" 
                    placeholder="Szukaj w tytu≈Çach..." 
                    class="w-full bg-slate-800 text-white rounded-full py-2 pl-10 pr-4 focus:outline-none focus:ring-2 focus:ring-indigo-500 placeholder-slate-500 transition-all shadow-inner border border-slate-700"
                >
            </div>
        </div>
    </header>

    <!-- Powiadomienie w aplikacji -->
    <div x-show="inAppNotification" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 translate-y-[-20px]"
         x-transition:enter-end="opacity-100 translate-y-0"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100 translate-y-0"
         x-transition:leave-end="opacity-0 translate-y-[-20px]"
         class="fixed top-20 left-1/2 transform -translate-x-1/2 z-[100] w-[90%] max-w-sm">
        <div class="bg-indigo-600 text-white p-4 rounded-xl shadow-2xl border border-indigo-400 flex items-center">
            <div class="mr-3 bg-white/20 p-2 rounded-full">
                <i class="fas fa-info-circle"></i>
            </div>
            <div>
                <p class="font-bold text-sm" x-text="inAppNotification?.title"></p>
                <p class="text-xs opacity-90" x-text="inAppNotification?.body"></p>
            </div>
        </div>
    </div>

    <div x-show="showReminders" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 -translate-y-10"
         x-transition:enter-end="opacity-100 translate-y-0"
         class="max-w-md mx-auto w-full px-4 pt-4">
        <div class="bg-gradient-to-br from-amber-500/10 to-orange-500/10 border border-amber-500/30 rounded-xl p-4 backdrop-blur">
            <div class="flex justify-between items-center mb-3">
                <h2 class="text-lg font-bold text-amber-300 flex items-center">
                    <i class="fas fa-bell mr-2"></i>NadchodzƒÖce przypomnienia
                </h2>
                <button @click="showReminders = false" class="text-amber-400 hover:text-amber-300">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <template x-if="upcomingReminders.length === 0">
                <p class="text-slate-400 text-sm text-center py-4">Brak aktywnych przypomnie≈Ñ</p>
            </template>
            
            <div class="space-y-2">
                <template x-for="reminder in upcomingReminders" :key="reminder.id">
                    <div class="bg-slate-800/50 rounded-lg p-3 flex justify-between items-start">
                        <div class="flex-1">
                            <p class="text-white text-sm font-medium mb-1" x-text="reminder.title"></p>
                            <p class="text-amber-400 text-xs flex items-center">
                                <i class="far fa-clock mr-1"></i>
                                <span x-text="formatReminderTime(reminder.reminderDate)"></span>
                            </p>
                        </div>
                        <button @click="deleteReminder(reminder.id)" class="text-slate-500 hover:text-red-400 ml-2">
                            <i class="fas fa-trash-alt text-sm"></i>
                        </button>
                    </div>
                </template>
            </div>
        </div>
    </div>

    <main class="max-w-md mx-auto p-4 space-y-6 flex-grow pb-36 w-full">
        <template x-if="isLoading">
            <div class="text-center text-slate-500 mt-10">
                <i class="fas fa-spinner fa-spin fa-2x mb-2"></i>
                <p>≈Åadowanie wspomnie≈Ñ...</p>
            </div>
        </template>

        <template x-if="!isLoading && filteredNotes.length === 0">
            <div class="text-center text-slate-600 mt-20 flex flex-col items-center">
                <div class="bg-slate-800 p-6 rounded-full mb-4">
                    <i class="fas fa-feather-alt text-4xl text-slate-700"></i>
                </div>
                <p class="text-lg">Brak notatek</p>
                <p class="text-sm opacity-60">Naci≈õnij mikrofon, aby zaczƒÖƒá.</p>
                <p class="text-xs text-amber-400 mt-2">üí° Powiedz: "Przypomnij mi jutro o 10"</p>
            </div>
        </template>

        <template x-for="group in groupedNotes" :key="group.title">
            <div class="space-y-3">
                <h2 class="text-xs font-bold text-slate-500 uppercase tracking-wider pl-1" x-text="group.title"></h2>

                <template x-for="note in group.notes" :key="note.id">
                    <div class="bg-slate-800 rounded-xl p-5 shadow-lg relative group transition-all hover:bg-slate-750 border border-slate-700/50"
                         :class="note.hasReminder && !note.reminderCompleted ? 'ring-2 ring-amber-500/30' : ''">
                        
                        <div x-show="note.hasReminder && !note.reminderCompleted" class="absolute -top-2 -right-2 bg-amber-500 text-white text-xs px-2 py-1 rounded-full flex items-center space-x-1 reminder-badge">
                            <i class="fas fa-bell text-xs"></i>
                            <span x-text="formatReminderBadge(note.reminderDate)"></span>
                        </div>

                        <div class="absolute top-3 right-3 flex space-x-2 opacity-0 group-hover:opacity-100 transition-opacity">
                            <button @click="startEditing(note)" x-show="editingNoteId !== note.id" class="text-slate-500 hover:text-indigo-400 p-2"><i class="fas fa-pen"></i></button>
                            <button @click="deleteNote(note.id)" x-show="editingNoteId !== note.id" class="text-slate-500 hover:text-red-400 p-2"><i class="fas fa-times"></i></button>
                        </div>
                        
                        <div class="mb-2">
                            <h3 class="text-lg font-bold text-white leading-tight" x-text="note.title || 'Bez tytu≈Çu'"></h3>
                        </div>

                        <div class="text-xs text-indigo-400 font-medium mb-3 flex items-center">
                            <i class="far fa-clock mr-1"></i>
                            <span x-text="formatTime(note.date)"></span>
                        </div>
                        
                        <div x-show="editingNoteId !== note.id">
                            <p class="text-slate-300 text-sm leading-relaxed whitespace-pre-wrap opacity-80" x-text="note.text"></p>
                        </div>

                        <div x-show="editingNoteId === note.id" class="mt-2">
                            <textarea x-model="editingText" class="w-full bg-slate-900/50 text-white rounded-lg p-3 border border-indigo-500/50 focus:outline-none focus:ring-2 focus:ring-indigo-500 resize-y text-sm" rows="3"></textarea>
                            <div class="flex justify-end space-x-3 mt-3">
                                <button @click="cancelEditing()" class="text-sm text-slate-400 hover:text-white px-3 py-1">Anuluj</button>
                                <button @click="saveEdit(note.id)" class="text-sm bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-1.5 rounded-full shadow-lg flex items-center">
                                    <i class="fas fa-save mr-2"></i> Zapisz
                                </button>
                            </div>
                        </div>
                    </div>
                </template>
            </div>
        </template>
    </main>

    <footer class="text-center py-6 text-slate-600 text-xs z-10 bg-slate-900 w-full">
        <span>Wykonanie Tomasz Wawrzak 2026 z asystƒÖ AI Gemini</span>
    </footer>

    <!-- Overlay Nagrywania -->
    <div x-show="isRecording"
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 translate-y-10"
         x-transition:enter-end="opacity-100 translate-y-0"
         class="fixed bottom-40 left-0 right-0 px-4 z-40 pointer-events-none">
        <div class="max-w-md mx-auto bg-slate-800/90 backdrop-blur border border-indigo-500/30 p-4 rounded-2xl shadow-2xl text-center pointer-events-auto">
            <p class="text-indigo-300 text-sm mb-1 font-semibold animate-pulse flex justify-center items-center">
                <span class="recording-wave"></span>
                <span class="recording-wave"></span>
                <span class="recording-wave"></span>
                &nbsp;Nas≈Çuchiwanie...
            </p>
            <p class="text-white text-lg italic" x-text="currentTranscript || 'M√≥w teraz...'"></p>
            <p x-show="detectedReminder" class="text-amber-400 text-xs mt-2 animate-pulse">
                <i class="fas fa-bell mr-1"></i>Wykryto przypomnienie!
            </p>
        </div>
    </div>

    <!-- G≈Ç√≥wny Przycisk Mikrofonu -->
    <div class="fixed bottom-20 left-0 right-0 flex justify-center z-50 pointer-events-none">
        <button 
            @click="toggleRecording()" 
            class="pointer-events-auto w-16 h-16 rounded-full shadow-2xl flex items-center justify-center text-2xl transition-all duration-300 transform hover:scale-105 active:scale-95 focus:outline-none focus:ring-4 focus:ring-indigo-500/50"
            :class="isRecording ? 'bg-red-500 text-white animate-pulse-fast ring-4 ring-red-500/30' : 'bg-indigo-500 text-white hover:bg-indigo-600'"
            aria-label="Nagrywaj">
            <i class="fas" :class="isRecording ? 'fa-stop' : 'fa-microphone'"></i>
        </button>
    </div>

    <!-- Modal B≈Çƒôdu -->
    <div x-show="errorMsg" class="fixed inset-0 z-[60] flex items-center justify-center bg-black/80 backdrop-blur-sm p-4" x-transition.opacity>
        <div class="bg-slate-800 rounded-2xl p-6 max-w-sm w-full text-center border border-red-500/30 shadow-2xl">
            <div class="w-12 h-12 bg-red-500/10 rounded-full flex items-center justify-center mx-auto mb-4"><i class="fas fa-exclamation-triangle text-red-500 text-xl"></i></div>
            <h3 class="text-lg font-bold text-white mb-2">WystƒÖpi≈Ç b≈ÇƒÖd</h3>
            <p class="text-slate-300 mb-6 text-sm" x-text="errorMsg"></p>
            <button @click="errorMsg = null" class="bg-slate-700 hover:bg-slate-600 text-white px-6 py-2 rounded-full w-full transition-colors">Rozumiem</button>
        </div>
    </div>
</body>
</html>